# Error recovery
set @@default_storage_engine=Aria;
create table t1 (a int);
insert t1 values (1), (1);
create table t2 (c int);
create or replace table t2 (a int, b int, key k (a), key k (b));
ERROR 42000: Duplicate key name 'k'
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
create or replace table t2 (a int, b int, key k (a), key k (b)) as select a, a as b from t1;
ERROR 42000: Duplicate key name 'k'
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
create or replace table t2 (a int primary key) as select * from t1;
ERROR 23000: Duplicate entry '1' for key 'PRIMARY'
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
set @old_mode= @@sql_mode;
set @@sql_mode='ALLOW_INVALID_DATES';
create table t3 (dt datetime default '2008-02-31 00:00:00');
set @@sql_mode= @old_mode;
create or replace table t2 like t3;
ERROR 42000: Invalid default value for 'dt'
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
drop tables t1, t2, t3;
# Crash recovery
create table const_table (new int, b int) engine=myisam;
insert into const_table values (1,1),(2,2);
flush tables;
# QUERY: CREATE OR REPLACE TABLE t1 (new int)
# CRASH POINT: ddl_log_create_before_create_frm
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_drop
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_binlog
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_prepare_eof
# No crash!
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 (new int)
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_after_binlog
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 (new int)
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_log_complete
# No crash!
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 (new int)
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# QUERY: CREATE OR REPLACE TABLE t1 LIKE const_table
# CRASH POINT: ddl_log_create_before_create_frm
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_drop
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_binlog
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_prepare_eof
# No crash!
t1.MYD
t1.MYI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 LIKE const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_after_binlog
t1.MYD
t1.MYI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 LIKE const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_log_complete
# No crash!
t1.MYD
t1.MYI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 LIKE const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# QUERY: CREATE OR REPLACE TABLE t1 SELECT * from const_table
# CRASH POINT: ddl_log_create_before_create_frm
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_create_table
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_drop
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_before_binlog
t1.MAD
t1.MAI
t1.TRG
t1.frm
Table	Create Table
t1	CREATE TABLE `t1` (
  `old` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
a	INSERT	t1	set @s= 1	BEFORE						
# CRASH POINT: ddl_log_create_after_prepare_eof
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 SELECT * from const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_after_binlog
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 SELECT * from const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
# CRASH POINT: ddl_log_create_log_complete
t1.MAD
t1.MAI
t1.frm
master-bin.000001	#	Query	#	#	use `test`; CREATE OR REPLACE TABLE t1 SELECT * from const_table
Table	Create Table
t1	CREATE TABLE `t1` (
  `new` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
Trigger	Event	Table	Statement	Timing	Created	sql_mode	Definer	character_set_client	collation_connection	Database Collation
Warnings:
Note	1051	Unknown table 'test.t1'
